<!DOCTYPE html>
<html>
<head>
  <script src="d3.js"></script>
  <style>
    .active:hover {
      filter: drop-shadow(0 0 5px rgba(0, 0, 0, 1));
    }

    .vertex {
      stroke: black;
      stroke-width: 2px;
      fill: white;
    }

    #paper {
      border: 1px solid grey;
    }

  </style>
</head>
<body>
<h1>Test</h1>

<div id="paper-container"></div>

<br>
<button id="btn-select" onclick="activateButton(this,'select')">Select</button>
<button id="btn-move" onclick="activateButton(this,'move')">Move</button>
<button id="btn-place_filled" onclick="activateButton(this,'place_filled')">Place filled vertex</button>
<button id="btn-place_unfilled" onclick="activateButton(this,'place_unfilled')">Place unfilled vertex</button>





<script>
  var width = 600;
	var height = 600;
  var paper = d3.select("#paper-container")
    .append("svg")
    .attr("id", "paper")
    .attr("width", width)
    .attr("height", height);

  var item = paper.append("circle")
    .attr("id", "c1")
    .attr("class", "vertex")
    .attr("cx", 150)
    .attr("cy", 200)
    .attr("r", 4);

  var paper_s =document.getElementById("paper");
  var item_s = document.getElementById("c1");

  var modes = {
    "select": {
      activate: activateSelect,
      deactivate: deactivateSelect
    },
    "move": {
      activate: activateMove,
      deactivate: deactivateMove
    },
    "place_filled": {
      activate: activateFilled,
      deactivate: deactivateFilled
    },
    "place_unfilled": {
      activate: activateUnfilled,
      deactivate: deactivateUnfilled
    },
  };

  var activeButton = false;
  var activeMode = false;

  var selectedElement = false;


  function activateButton(obj, mode) {
    if(activeButton) {
      activeButton.style.borderStyle = 'outset';
    }
    activeButton = obj;
    activeButton.style.borderStyle = 'inset';
    if(activeMode) {
      activeMode.deactivate();
    }
    activeMode = modes[mode];
    activeMode.activate();
  }

  function activateSelect(obj) {
    mode = "select";
  }

  function deactivateSelect(obj) {
    deactivateAllObjects();
  }

  var deltaX, deltaY;

  var dragHandler = d3.drag()
      .on("drag", function (d) {
          d3.select(this)
              .attr("cx", d.x = d3.event.x)
              .attr("cy", d.y = d3.event.y);
      });



  function activateMove(obj) {
    let mydrag = d3.drag();
    mydrag.on("drag", function(event) {
      d3.select(this)
        .attr("cx", event.x)
        .attr("cy", event. y);
    });
    mode = "move";
    activateObjects(".vertex");
    //dragHandler(paper.selectAll(".vertex"));
    paper.selectAll(".vertex").call(mydrag);

    /*  .on('mousedown', function(e) {
        const circle = e.target;
        circle.style = "fill:green";
        selectedElement = circle;
      });
    d3.select("#paper")
      .on('mousemove', function(e) {
        //console.log(e.offsetX,e.offsetY);
        if(selectedElement) {
          selectedElement.setAttribute('cx', e.offsetX);
          selectedElement.setAttribute('cy', e.offsetY);
        }
      })
      .on('mouseup', function(e) {
        //console.log("mouse up");
        selectedElement = false;
      });
      d3.select("#paper").on('mouseout', function(e) {
        //console.log("mouse up");
        selectedElement = false;
      });
      */
  }

  function deactivateMove(obj) {
    deactivateAllObjects();
  }


  function activateFilled(obj) {
    mode = "place_filled";
  }

  function deactivateFilled(obj) {
  }

  function activateUnfilled(obj) {
    mode = "place_unfilled";
  }

  function deactivateUnfilled(obj) {
  }


  function deactivateAllObjects() {
    paper.selectAll("*").classed("active", false);
  }

  function activateObjects(selector) {
    paper.selectAll(selector).classed("active", true);
  }

  function placeVertex(x,y,cls) {
    //paper.
  }






activateButton(document.querySelector('#btn-select'),'select');


</script>
</body>
</html>
